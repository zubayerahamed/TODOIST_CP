<!-- Create Event Modal -->
<div class="modal-backdrop" *ngIf="isAddEventModalOpen" (click)="onEventModalBackdropClick($event)">
  <div class="modal-container modal-lg d-flex flex-column">
    <div class="modal-header d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <i class="ph ph-calendar-plus me-2 fs-4"></i>
        <h4 class="modal-title">Create New Event</h4>
      </div>
      <button type="button" class="btn-close d-flex align-items-center justify-content-center"
              (click)="closeAddEventModal()">
        <i class="ph ph-x fs-4"></i>
      </button>
    </div>
    <div class="modal-body flex-grow-1">
      <form>
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="eventDate" class="form-label">Date *</label>
              <input type="date" class="form-control" id="eventDate">
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label for="eventStartTime" class="form-label">Start Time *</label>
              <input type="time" class="form-control" id="eventStartTime">
            </div>
          </div>
          <div class="col-md-3">
            <div class="mb-3">
              <label for="eventEndTime" class="form-label">End Time *</label>
              <input type="time" class="form-control" id="eventEndTime">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-4">
            <div class="mb-3">
              <label for="eventTitle" class="form-label">Event Title *</label>
              <input type="text" class="form-control" id="eventTitle" placeholder="Enter event title">
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label for="eventProject" class="form-label"><i class="ph ph-hash me-2"></i>Project</label>
              <select class="form-select" id="eventProject">
                <option value="">-- Select Project --</option>
                <option value="office">Office Work</option>
                <option value="house">House Work</option>
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label for="eventCategory" class="form-label"><i class="ph ph-tag me-2"></i>Category</label>
              <select class="form-select" id="eventCategory">
                <option value="">-- Select Category --</option>
                <option value="Software Development">Software Development</option>
                <option value="Iterview">Interview</option>
                <option value="Exam">Exam</option>
              </select>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="eventDescription" class="form-label">Description</label>
          <textarea class="form-control" id="eventDescription" rows="3"
                    placeholder="Enter event description"></textarea>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="eventLocation" class="form-label"><i class="ph ph-map-pin me-2"></i>Location</label>
              <input type="text" class="form-control" id="eventLocation" placeholder="Enter location">
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label for="reminder" class="form-label d-flex align-items-center">
                <i class="ph ph-bell me-2"></i>Reminder
              </label>
              <select class="form-select" id="reminder">
                <option value="">-- Select Reminder --</option>
                <option value="0">At the time of event</option>
                <option value="5">5 minute before</option>
                <option value="10">10 minute before</option>
                <option value="15">15 minute before</option>
                <option value="30">30 minute before</option>
                <option value="60">1 hour before</option>
                <option value="120">2 hour before</option>
                <option value="360">6 hour before</option>
                <option value="720">12 hour before</option>
                <option value="1440">1 day before</option>
              </select>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label"><i class="ph ph-users-three me-2"></i>Participants</label>
          <div class="d-flex align-items-center gap-3 flex-wrap">
            @for(participant of selectedParticipants; track participant.id) {
              <div class="participant-item">
                <img
                     [src]="participant.avatar"
                     class="rounded-circle participant-avatar"
                     [alt]="participant.name"
                     [title]="participant.name + ' - ' + participant.email"
                     data-bs-toggle="tooltip"
                     data-bs-placement="top">
                <button type="button" class="participant-remove-btn" (click)="removeParticipant(participant.id)">
                  <i class="ph ph-x"></i>
                </button>
              </div>
              }
              <div class="participant-search-container">
                <button type="button" class="btn btn-outline-secondary btn-sm d-flex align-items-center"
                        (click)="openParticipantSearch()">
                  <i class="ph ph-plus me-1"></i><span>Add Participant</span>
                </button>

                <!-- Participant Search Dropdown -->
                <div class="participant-search-dropdown" *ngIf="isParticipantSearchOpen">
                  <div class="participant-search-header">
                    <input
                           type="text"
                           class="form-control participant-search-input"
                           placeholder="Search participants..."
                           [value]="participantSearchQuery"
                           (input)="onParticipantSearchInput($event)"
                           #searchInput>
                    <button type="button" class="btn-close-search" (click)="closeParticipantSearch()">
                      <i class="ph ph-x"></i>
                    </button>
                  </div>
                  <div class="participant-search-results">
                    @for(participant of filteredParticipants; track participant.id) {
                      <div class="participant-search-item"
                           (click)="addParticipant(participant)">
                        <img [src]="participant.avatar" class="rounded-circle participant-search-avatar"
                             [alt]="participant.name">
                        <div class="participant-info">
                          <div class="participant-name">{{ participant.name }}</div>
                          <div class="participant-email">{{ participant.email }}</div>
                        </div>
                      </div>

                      }

                      @if(filteredParticipants.length === 0) {
                        <div class="no-participants">
                          No participants found
                        </div>
                        }
                  </div>
                </div>
              </div>
          </div>
        </div>

        <!-- Divider -->
        <div class="divider mb-3"></div>

        <!-- Checklist Section -->
        <div class="mb-3">
          <label class="form-label d-flex align-items-center justify-content-between">
            <span class="d-flex align-items-center">
              <i class="ph ph-list-checks me-2"></i>Checklist
            </span>
            <span class="checklist-progress-info" *ngIf="checklistItems.length > 0">
              {{ completedChecklistCount }}/{{ checklistItems.length }} completed ({{ checklistProgress }}%)
            </span>
          </label>

          <!-- Progress Bar -->
          <div class="progress mb-3" *ngIf="checklistItems.length > 0">
            <div
                 class="progress-bar bg-success"
                 role="progressbar"
                 [style.width.%]="checklistProgress"
                 [attr.aria-valuenow]="checklistProgress"
                 aria-valuemin="0"
                 aria-valuemax="100">
            </div>
          </div>

          <!-- Add New Checklist Item -->
          <div class="add-checklist-section mb-3">
            <div class="input-group">
              <input
                     type="text"
                     class="form-control"
                     placeholder="Add checklist item..."
                     [value]="newChecklistItem"
                     (input)="onChecklistInputChange($event)"
                     (keypress)="onChecklistInputKeyPress($event)">
              <button
                      type="button"
                      class="btn btn-outline-secondary"
                      (click)="addChecklistItem()"
                      [disabled]="!newChecklistItem.trim()">
                <i class="ph ph-plus"></i>
              </button>
            </div>
          </div>

          <!-- Checklist Items -->
          <div class="checklist-items-container" *ngIf="checklistItems.length > 0">
            <div *ngFor="let item of checklistItems"
                 class="checklist-item d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center fex-grow-1">
                <input
                       class="form-check-input me-2"
                       type="checkbox"
                       [id]="'checklist-' + item.id"
                       [checked]="item.completed"
                       (change)="toggleChecklistItem(item.id)">
                <label
                       class="form-check-label"
                       [for]="'checklist-' + item.id"
                       [class.text-decoration-line-through]="item.completed"
                       [class.text-muted]="item.completed">
                  {{ item.text }}
                </label>
              </div>
              <button
                      type="button"
                      class="checklist-remove-btn"
                      (click)="removeChecklistItem(item.id)">
                <i class="ph ph-x"></i>
              </button>
            </div>
          </div>


        </div>

        <!-- Divider -->
        <div class="divider mb-3"></div>

        <!-- File Attachments Section -->
        <div class="mb-3">
          <label class="form-label d-flex align-items-center">
            <i class="ph ph-paperclip me-2"></i>Attachments
          </label>

          <!-- Attached Files Display -->
          <div class="attached-files-container" *ngIf="attachedFiles.length > 0">
            <div *ngFor="let file of attachedFiles" class="attached-file-item">
              <div class="file-icon">
                {{ file.icon }}
              </div>
              <div class="file-info">
                <div class="file-name">{{ file.name }}</div>
                <div class="file-size">{{ formatFileSize(file.size) }}</div>
              </div>
              <button type="button" class="file-remove-btn" (click)="removeFile(file.id)">
                <i class="ph ph-trash"></i>
              </button>
            </div>
          </div>

          <!-- Add File Button -->
          <div class="attach-file-section">
            <input
                   type="file"
                   id="fileInput"
                   class="file-input"
                   multiple
                   (change)="onFileSelect($event)"
                   #fileInput>
            <button
                    type="button"
                    class="btn btn-outline-secondary btn-sm attach-file-btn d-flex align-items-center"
                    (click)="fileInput.click()">
              <i class="ph ph-plus me-1"></i><span>Attach file</span>
            </button>
          </div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeAddEventModal()">Cancel</button>
      <button type="button" class="btn btn-primary d-flex align-items-center justify-content-center">
        <i class="ph ph-calendar-plus me-2"></i><span>Create Event</span>
      </button>
    </div>
  </div>
</div>
